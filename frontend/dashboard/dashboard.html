<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style_dashboard.css">
  <title>SevaSetu Dashboard</title>
</head>
<body>
  <header>
    <div class="logo">
      <h1>SevaSetu</h1>
      <p>Government welfare awareness</p>
    </div>
  </header>

  <div class="container">
    <nav>
      <ul>
        <li><a href="dashboard.html" class="active">Dashboard</a></li>
        <li><a href="applications.html">My Applications</a></li>
        <li><a href="available_scheme.html">Available Schemes</a></li>
        <li><a href="eligibility-checker.html">Eligibility Checker</a></li>
        <li><a href="settings.html">My Details</a></li>
      </ul>
    </nav>

    <main>
      <section class="card-group">
        <div class="card">
          <h3>Current Benefits</h3>
          <p><img src="/frontend/assests/images/Food.png" alt="Food" class="icon"> Food Subsidy - <strong>Active</strong></p>
          <p><img src="/frontend/assests/images/health.png" alt="Health" class="icon"> Health Assistance - <strong>Active</strong></p>
          <p><img src="/frontend/assests/images/Housing.png" alt="Housing" class="icon"> Housing Aid - <strong>Pending</strong></p>
        </div>

        <div class="card">
          <h3>Quick Actions</h3>
          <div class="button-group">
            <button class="btn">Apply for Scheme</button>
            <button class="btn">Check Eligibility</button>
            <button class="btn">Download Documents</button>
          </div>
        </div>
      </section>
    </main>

    <aside class="sidebar">
      <div class="card">
        <h3><img src="/frontend/assests/images/notification.png" alt="Notify" class="icon"> Notifications</h3>
        <ul>
          <li>New housing scheme open</li>
          <li>Update Aadhaar details</li>
        </ul>
      </div>
    </aside>
  </div>

  <div class="assistant-icon">
    <img src="/frontend/assests/images/assistant.png" alt="Assistant">
  </div>

  <div class="chatbox" id="chatbox">
    <div class="chat-header">
      Assistant <button id="mic-btn" title="Voice Input">ðŸŽ¤</button>
    </div>
    <div class="chat-messages" id="chat-messages"></div>
    <div class="chat-controls">
      <input type="text" id="chat-input" placeholder="Type your message...">
      <button id="send-btn">Send</button>
    </div>
  </div>

  <script>
    const assistantIcon = document.querySelector('.assistant-icon');
    const chatbox = document.getElementById('chatbox');
    const micBtn = document.getElementById('mic-btn');
    const sendBtn = document.getElementById('send-btn');
    const chatInput = document.getElementById('chat-input');
    const chatMessages = document.getElementById('chat-messages');

    assistantIcon.addEventListener('click', () => {
      chatbox.classList.toggle('show');
    });

    function appendMessage(content, isUser = true) {
      const msgDiv = document.createElement('div');
      msgDiv.className = isUser ? 'user-msg' : 'assistant-msg';
      msgDiv.textContent = content;
      chatMessages.appendChild(msgDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    async function fetchResponse(message) {
      appendMessage(message, true);
      try {
        const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyBJPBRaG5bWNcx6C-XyL-0e_w531w-k-MM", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ contents: [{ parts: [{ text: message }] }] })
        });
        const data = await response.json();
        const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "âš ï¸ No reply.";
        appendMessage(reply, false);
        speakText(reply);
      } catch (error) {
        appendMessage("âš ï¸ Error: " + error.message, false);
      }
    }

    function speakText(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      speechSynthesis.speak(utterance);
    }

    sendBtn.addEventListener('click', () => {
      const message = chatInput.value.trim();
      if (message) {
        fetchResponse(message);
        chatInput.value = '';
      }
    });

    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') sendBtn.click();
    });

    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'en-US';
    micBtn.addEventListener('click', () => recognition.start());

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      chatInput.value = transcript;
      fetchResponse(transcript);
    };
  </script>
</body>
</html>
